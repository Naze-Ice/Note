## 持久化

- RDB：快照形式
  - save：保存快照，同步，会阻塞客户端指令
  - bgsave：后台保存快照，异步非阻塞，通过fork()函数开启**子进程**执行
  - save配置：指定多少时间内发生多少变化
- AOF：日志形式

## 过期数据删除策略

数据删除策略目标是在内存占用和CPU占用之间寻找平衡

- 定时删除（处理器性能换取存储空间）：创建一个定时器，当key设置有过期时间且已经过期则立即删除键
  - 优点：节约内存
  - 缺点：CPU压力大，无论CPU负载量多高都会占用CPU，会影响redis服务器的响应速度和吞吐量
- 惰性删除（存储空间换取处理器性能）：数据过期时不处理，访问该数据时，如果发现过期则删除，返回不存在
  - 优点：节约CPU性能
  - 缺点内存压力大
- 定期删除：

## 分布式锁

Redis做分布式锁的问题

- 死锁：如果解锁时删除键失败，将陷入死锁，所以锁必须设置过期时间，且设置锁和过期时间的操作必须具有原子性

  > Redis2.8以后加入了set的参数设置nx和ex，相当于setnx和expire组合在一起的原子操作

- 超时：锁过期后

  > 可通过给value设置随机值，删除先判断valueLUA脚本

- 可重入性：